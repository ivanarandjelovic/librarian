<project name="librarian_db" basedir=".." xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:ac="antlib:net.sf.antcontrib">
	<description>
		Database related build tasks for librarian
	</description>

	<taskdef resource="net/sf/antcontrib/antcontrib.properties" />

	<property name="db.dir" location="db" />

	<target name="db_drop_user" description="drop user">
		<sql driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost/mysql" classpathref="run.path.id" userid="root" password="root" src="${db.dir}/db_drop_user.sql" />
	</target>
	
 	<target name="db_drop_database" description="drop database">
		<sql driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost/mysql" classpathref="run.path.id" userid="root" password="root" src="${db.dir}/db_drop_database.sql" />
	</target>

	<target name="db_create_database" description="create database">
		<sql driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost/mysql" classpathref="run.path.id" userid="root" password="root" src="${db.dir}/db_create_database.sql" />
	</target>

	<target name="db_create_user" description="create user">
		<sql driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost/mysql" classpathref="run.path.id" userid="root" password="root" src="${db.dir}/db_create_user.sql" />
	</target>


	<target name="db_re-create_all" description="create all database objects from scratch">
		<antcall target="db_drop_database"/>
		<antcall target="db_drop_user"/>
		<antcall target="db_create_user"/>
		<antcall target="db_create_database"/>
		<ac:for param="file">
			<path>
				<fileset dir="${db.dir}/tables/" includes="*.sql" />
			</path>
			<sequential>
				<sql driver="com.mysql.jdbc.Driver" url="jdbc:mysql://localhost/dev_librarian" classpathref="run.path.id" userid="dev_librarian" password="dev_librarian" src="@{file}" />
			</sequential>
		</ac:for>
	</target>


</project>